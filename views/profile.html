<!-- Vista del Perfil de Usuario -->
<div class="container py-5">
  <!-- Encabezado de la página -->
  <div class="row mb-4">
    <div class="col-md-12">
      <h1 class="mb-4 border-bottom pb-2">
        <i class="fas fa-user-circle me-2"></i>Mi Perfil
      </h1>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Inicio</a></li>
          <li class="breadcrumb-item active" aria-current="page">Perfil</li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- Tarjeta principal de perfil -->
  <div class="row">
    <div class="col-lg-8 mx-auto">
      <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="fas fa-id-card me-2"></i>Información Personal
          </h5>
        </div>
        <div class="card-body">
          <% if (profile) { %>
          <div class="row">
            <!-- Foto de perfil -->
            <div class="col-md-4 text-center mb-4 mb-md-0">
              <div class="profile-image mb-3">
                <img
                  src="/img/logo.webp"
                  alt="Foto de perfil"
                  class="img-thumbnail rounded-circle"
                  style="width: 150px; height: 150px; object-fit: cover"
                />
              </div>
              <div class="role-badge">
                <span
                  class="badge <%= profile.role === 'medico' ? 'bg-success' : 'bg-info' %> py-2 px-3"
                >
                  <i
                    class="fas <%= profile.role === 'medico' ? 'fa-user-md' : 'fa-user' %> me-1"
                  ></i>
                  <%= profile.role === 'medico' ? 'Médico' : 'Paciente' %>
                </span>
              </div>
            </div>

            <!-- Detalles del perfil -->
            <div class="col-md-8">
              <table class="table table-hover">
                <tbody>
                  <tr>
                    <th scope="row" style="width: 40%">
                      <i class="fas fa-user me-2"></i>Nombre:
                    </th>
                    <td><%= profile.name %></td>
                  </tr>
                  <tr>
                    <th scope="row">
                      <i class="fas fa-envelope me-2"></i>Email:
                    </th>
                    <td><%= profile.email %></td>
                  </tr>
                  <tr>
                    <th scope="row">
                      <i class="fas fa-phone me-2"></i>Teléfono:
                    </th>
                    <td><%= profile.phone || 'No especificado' %></td>
                  </tr>
                  <tr>
                    <th scope="row">
                      <i class="fas fa-calendar-alt me-2"></i>Miembro desde:
                    </th>
                    <td>
                      <%= new
                      Date(profile.created_at).toLocaleDateString('es-ES', {
                      year: 'numeric', month: 'long', day: 'numeric' }) %>
                    </td>
                  </tr>
                </tbody>
              </table>

              <!-- Biografía -->
              <% if (profile.bio) { %>
              <div class="mt-3">
                <h6 class="border-bottom pb-2">
                  <i class="fas fa-quote-left me-2"></i>Biografía
                </h6>
                <p class="text-muted"><%= profile.bio %></p>
              </div>
              <% } %>

              <!-- Botón de editar -->
              <div class="mt-4">
                <a href="/profile/edit" class="btn btn-primary">
                  <i class="fas fa-edit me-1"></i> Editar Perfil
                </a>
              </div>
            </div>
          </div>
          <% } else { %>
          <!-- Mensaje de error si no se puede cargar el perfil -->
          <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i>
            No se pudo cargar la información del perfil. Por favor, inicia
            sesión nuevamente o contacta con soporte.
          </div>
          <% } %>
        </div>
      </div>

      <!-- Sección de estadísticas (condicional para pacientes) -->
      <% if (profile && profile.role === 'paciente') { %>
      <div class="card shadow mb-4">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0">
            <i class="fas fa-chart-pie me-2"></i>Resumen de Actividad
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 text-center mb-3">
              <div class="stat-circle mx-auto">
                <h3>
                  <%= (typeof stats !== 'undefined' && stats?.totalMeals) || 0
                  %>
                </h3>
              </div>
              <p class="mt-2">Comidas Registradas</p>
            </div>
            <div class="col-md-4 text-center mb-3">
              <div class="stat-circle mx-auto">
                <h3>
                  <%= (typeof stats !== 'undefined' && stats?.daysActive) || 0
                  %>
                </h3>
              </div>
              <p class="mt-2">Días Activos</p>
            </div>
            <div class="col-md-4 text-center mb-3">
              <div class="stat-circle mx-auto">
                <h3>
                  <%= (typeof stats !== 'undefined' && stats?.streakDays) || 0
                  %>
                </h3>
              </div>
              <p class="mt-2">Racha Actual</p>
            </div>
          </div>

          <div class="text-center mt-3">
            <a href="/patient/history" class="btn btn-outline-primary">
              <i class="fas fa-history me-1"></i> Ver Historial Completo
            </a>
          </div>
        </div>
      </div>
      <% } %>

      <!-- Sección para médicos (condicional) -->
      <% if (profile && profile.role === 'medico') { %>
      <div class="card shadow">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">
            <i class="fas fa-user-friends me-2"></i>Resumen de Pacientes
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 text-center mb-3">
              <div class="stat-box p-3 rounded shadow-sm">
                <i class="fas fa-users fa-2x mb-2 text-success"></i>
                <h3>
                  <%= (typeof stats !== 'undefined' && stats?.totalPatients) ||
                  0 %>
                </h3>
                <p class="text-muted">Pacientes Totales</p>
              </div>
            </div>
            <div class="col-md-6 text-center mb-3">
              <div class="stat-box p-3 rounded shadow-sm">
                <i class="fas fa-user-check fa-2x mb-2 text-info"></i>
                <h3>
                  <%= (typeof stats !== 'undefined' && stats?.activePatients) ||
                  0 %>
                </h3>
                <p class="text-muted">Activos en última semana</p>
              </div>
            </div>
          </div>

          <div class="text-center mt-3">
            <a href="/doctor/patients" class="btn btn-outline-success">
              <i class="fas fa-clipboard-list me-1"></i> Gestionar Pacientes
            </a>
          </div>
        </div>
      </div>
      <% } %>
    </div>
  </div>
</div>

<!-- Estilos específicos para la página de perfil -->
<style>
  .stat-circle {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f8f9fa;
    border: 2px solid #dee2e6;
  }

  .stat-box {
    background-color: #f8f9fa;
    transition: transform 0.3s ease;
  }

  .stat-box:hover {
    transform: translateY(-5px);
  }

  .role-badge {
    margin-top: 10px;
  }
</style>
